using Avalonia.Controls;
using System;
using System.Diagnostics;
using System.DirectoryServices.Protocols;
using System.Net;
public static class ActiveDirectoryTools
{
   public static LdapConnection? LdapConnection { get; set; }
    static ActiveDirectoryTools() => LdapConnection = null;
    public static string ConnectActiveDirectory(string domain) {
        try
        {
            // Attempt a connection without creds.
            LdapConnection = new LdapConnection(domain);
            LdapConnection.Bind();
        }
        catch (LdapException ex)
        {
            return ex.Message;
        }
        return "";
    }
    public static Boolean AuthenticateUser(string username, string password)
    {
        NetworkCredential credential = new NetworkCredential(username, password);
        try
        {
            if (LdapConnection != null)
            {
                LdapConnection.Bind(credential);
            }
        }
        catch (LdapException ex)
        {
            Debug.WriteLine(ex.Message);
            return false;
        }
        return true;
    }
}